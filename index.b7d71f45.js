function t(t,e){let i=t.flat(),s=i.map((t,e)=>0===t?e:null).filter(t=>null!==t);if(0===s.length)return t;for(let t=0;t<e&&0!==s.length;t++){let t=Math.floor(Math.random()*s.length),e=s.splice(t,1)[0],l=.9>Math.random()?2:4;i[e]=l}let l=[];for(;i.length;)l.push(i.splice(0,4));return l}function e(t){let e=function(t){for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)if(0===t[e][i])return!1;return!0}(t),i=function(t){for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)if(2048===t[e][i])return!0;return!1}(t);return e?"lose":i?"win":"playing"}function i(t,e){let i=0;for(let s=0;s<t.length;s++)for(let l=0;l<t[s].length;l++)e[s][l]>t[s][l]&&(i+=e[s][l]);return i}const s=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.state="idle",this.score=0,this.initialState=t}moveLeft(){if("idle"!==this.state){let s=this.initialState.map(t=>(function(t){for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&0!==t[e]&&(t[e]*=2,t[e+1]=0);let e=t.filter(t=>0!==t);for(;e.length<t.length;)e.push(0);return e})(t));this.state=e(s),this.score+=i(this.initialState,s);let l=t(s,1);return this.initialState=l,this.initialState}}moveRight(){if("idle"!==this.state){let s=this.initialState.map(t=>(function(t){let e=t.filter(t=>0!==t);for(let t=e.length-1;t>0;t--)e[t]===e[t-1]&&(e[t]*=2,e[t-1]=0);for(e=e.filter(t=>0!==t);e.length<t.length;)e.unshift(0);return e})(t));this.state=e(s),this.score+=i(this.initialState,s);let l=t(s,1);return this.initialState=l,this.initialState}}moveUp(){if("idle"!==this.state){let s=function(t){let e=t.map(t=>[...t]);for(let t=0;t<e[0].length;t++){let i=e.map(e=>e[t]);for(let t=0;t<i.length-1;t++)i[t]===i[t+1]&&0!==i[t]&&(i[t]*=2,i[t+1]=0);let s=i.filter(t=>0!==t);for(;s.length<i.length;)s.push(0);for(let i=0;i<e.length;i++)e[i][t]=s[i]}return e}(this.initialState);this.state=e(s),this.score+=i(this.initialState,s);let l=t(s,1);return this.initialState=l,this.initialState}}moveDown(){if("idle"!==this.state){let s=function(t){let e=t.map(t=>[...t]);for(let t=0;t<e[0].length;t++){let i=e.map(e=>e[t]);for(let t=i.length-1;t>0;t--)i[t]===i[t-1]&&0!==i[t]&&(i[t]*=2,i[t-1]=0);let s=i.filter(t=>0!==t);for(;s.length<i.length;)s.unshift(0);for(let i=0;i<e.length;i++)e[i][t]=s[i]}return e}(this.initialState);this.score+=i(this.initialState,s),this.state=e(s);let l=t(s,1);return this.initialState=l,this.initialState}}getScore(){return this.score}getState(){return this.initialState}getStatus(){return this.state}start(){let e=this.initialState.flat().every(t=>0===t)?t(this.initialState,2):t(this.initialState,1);return this.initialState=e,this.score=0,this.state="playing",this.initialState}restart(){return this.initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.state="idle",this.initialState}},l=document.querySelector(".game-score"),n=document.querySelector(".start"),r=document.querySelector(".message-win"),a=document.querySelector(".message-lose"),o=document.querySelector(".message-start"),h=document.querySelectorAll(".field-cell");function c(t){let e=t.flat();h.forEach((t,i)=>{t.textContent=e[i]||""});let i=s.getScore();l.textContent=i;let n=s.getStatus();"win"===n?r.classList.remove("hidden"):"lose"===n&&a.classList.remove("hidden")}function u(){o.classList.remove("hidden"),r.classList.add("hidden"),a.classList.add("hidden"),n.classList.add("start"),n.classList.remove("restart"),n.textContent="Start",c(s.restart())}function d(){if("idle"===s.getStatus()){let t=s.start();n.textContent="Restart",n.classList.add("restart"),n.classList.remove("start"),c(t),o.classList.add("hidden"),r.classList.add("hidden"),a.classList.add("hidden");return}"playing"===s.getStatus()&&u()}document.addEventListener("keydown",function(t){"Escape"===t.key&&u(),"Enter"===t.key&&d(),"playing"===s.getStatus()?("ArrowUp"===t.key&&c(s.moveUp()),"ArrowDown"===t.key&&c(s.moveDown()),"ArrowLeft"===t.key&&c(s.moveLeft()),"ArrowRight"===t.key&&c(s.moveRight())):"win"===s.getStatus()?(r.classList.remove("hidden"),n.classList.add("start"),n.classList.remove("restart"),n.textContent="Start"):"lose"===s.getStatus()&&(a.classList.remove("hidden"),n.classList.add("start"),n.classList.remove("restart"),n.textContent="Start")}),n.addEventListener("click",d);
//# sourceMappingURL=index.b7d71f45.js.map
